{"version":3,"sources":["meteor://ðŸ’»app/packages/meteorhacks_zones/packages/meteorhacks_zones.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6H","file":"/packages/meteorhacks_zones.js","sourcesContent":["(function () {\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                               //\n// packages/meteorhacks:zones/client/hijack.js                                                                   //\n//                                                                                                               //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                 //\n// Hijack only if zone is available                                                                              // 1\nif(!window.Zone || !window.Zone.inited) {                                                                        // 2\n  return;                                                                                                        // 3\n}                                                                                                                // 4\n                                                                                                                 // 5\n// some EnvironmentVariables to optimize tracking                                                                // 6\n// see /assests/utils.js                                                                                         // 7\nZone.fromCall = new Meteor.EnvironmentVariable();                                                                // 8\nZone.fromObserve = new Meteor.EnvironmentVariable();                                                             // 9\nZone.notFromForEach = new Meteor.EnvironmentVariable();                                                          // 10\n                                                                                                                 // 11\nvar ConnectionProto = getConnectionProto();                                                                      // 12\n                                                                                                                 // 13\n/*                                                                                                               // 14\n * Hijack method calls                                                                                           // 15\n */                                                                                                              // 16\nConnectionProto.apply = hijackConnection(                                                                        // 17\n  ConnectionProto.apply,                                                                                         // 18\n  'Connection.apply'                                                                                             // 19\n);                                                                                                               // 20\n                                                                                                                 // 21\n/**                                                                                                              // 22\n * For better stackTraces                                                                                        // 23\n */                                                                                                              // 24\nMeteor.call = hijackConnection(Meteor.call, 'Meteor.call');                                                      // 25\n                                                                                                                 // 26\n/*                                                                                                               // 27\n * Hijack DDP subscribe method                                                                                   // 28\n * Used when connecting to external DDP servers                                                                  // 29\n */                                                                                                              // 30\nConnectionProto.subscribe = hijackSubscribe(                                                                     // 31\n  ConnectionProto.subscribe,                                                                                     // 32\n  'Connection.subscribe'                                                                                         // 33\n);                                                                                                               // 34\n                                                                                                                 // 35\n/**                                                                                                              // 36\n * Hijack Meteor.subscribe because Meteor.subscribe binds to                                                     // 37\n * Connection.subscribe before the hijack                                                                        // 38\n */                                                                                                              // 39\nMeteor.subscribe = hijackSubscribe(Meteor.subscribe, 'Meteor.subscribe');                                        // 40\n                                                                                                                 // 41\nhijackCursor(LocalCollection.Cursor.prototype);                                                                  // 42\n                                                                                                                 // 43\n/**                                                                                                              // 44\n * Hijack Template.prototype.events() to add useful owner info to zone object                                    // 45\n * Use UI.Component.events for older versions of Meteor                                                          // 46\n * e.g. {type: 'templateEvent', event: 'click .selector', template: 'home'}                                      // 47\n */                                                                                                              // 48\nif(Template.prototype) {                                                                                         // 49\n  Template.prototype.events = hijackComponentEvents(Template.prototype.events);                                  // 50\n} else if (UI.Component) {                                                                                       // 51\n  UI.Component.events = hijackComponentEvents(UI.Component.events);                                              // 52\n}                                                                                                                // 53\n                                                                                                                 // 54\n/**                                                                                                              // 55\n * Hijack global template helpers using `UI.registerHelper`                                                      // 56\n */                                                                                                              // 57\nhijackGlobalHelpers(UI._globalHelpers);                                                                          // 58\nUI.registerHelper = hijackNewGlobalHelpers(UI.registerHelper);                                                   // 59\n                                                                                                                 // 60\n/**                                                                                                              // 61\n * Hijack each templates rendered handler to add template name to owner info                                     // 62\n */                                                                                                              // 63\nvar CoreTemplates = ['prototype', '__body__', '__dynamic', '__dynamicWithDataContext', '__IronDefaultLayout__']; // 64\nMeteor.startup(function () {                                                                                     // 65\n  _(Template).each(function (template, name) {                                                                   // 66\n    if(typeof template === 'object') {                                                                           // 67\n      // hijack template helpers including 'rendered'                                                            // 68\n      if(_.indexOf(CoreTemplates, name) === -1) {                                                                // 69\n        hijackTemplateHelpers(template, name);                                                                   // 70\n        template.helpers = hijackNewTemplateHelpers(template.helpers, name);                                     // 71\n      }                                                                                                          // 72\n    }                                                                                                            // 73\n  });                                                                                                            // 74\n});                                                                                                              // 75\n                                                                                                                 // 76\n/**                                                                                                              // 77\n * Hijack Session.set to add events                                                                              // 78\n */                                                                                                              // 79\nSession.set = hijackSessionSet(Session.set, 'Session.set');                                                      // 80\n                                                                                                                 // 81\n/**                                                                                                              // 82\n * Hijack Deps.autorun to set correct zone owner type                                                            // 83\n * Otherwise these will be setTimeout                                                                            // 84\n */                                                                                                              // 85\nDeps.flush = hijackDepsFlush(Deps.flush, 'Deps.flush');                                                          // 86\n                                                                                                                 // 87\n//--------------------------------------------------------------------------\\\\\n                                                                                                                 // 89\nfunction getConnectionProto() {                                                                                  // 90\n  var con = DDP.connect(getCurrentUrlOrigin());                                                                  // 91\n  con.disconnect();                                                                                              // 92\n  var proto = con.constructor.prototype;                                                                         // 93\n  return proto;                                                                                                  // 94\n}                                                                                                                // 95\n                                                                                                                 // 96\nfunction getCurrentUrlOrigin() {                                                                                 // 97\n  // Internet Explorer doesn't have window.location.origin                                                       // 98\n  return window.location.origin || window.location.protocol                                                      // 99\n  + window.location.hostname                                                                                     // 100\n  + window.location.port;                                                                                        // 101\n}                                                                                                                // 102\n                                                                                                                 // 103\n// we've a better error handling support with zones                                                              // 104\n// Meteor._debug will prevent it (specially inside deps)                                                         // 105\n// So we are killing Meteor._debug                                                                               // 106\nvar originalMeteorDebug = Meteor._debug;                                                                         // 107\nMeteor._debug = function(message, stack) {                                                                       // 108\n  var err = new Error(message);                                                                                  // 109\n  err.stack = (stack instanceof Error)? stack.stack: stack;                                                      // 110\n  if(zone) {                                                                                                     // 111\n    zone.onError(err);                                                                                           // 112\n  } else {                                                                                                       // 113\n    originalMeteorDebug(message, stack);                                                                         // 114\n  }                                                                                                              // 115\n};                                                                                                               // 116\n                                                                                                                 // 117\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n"]}